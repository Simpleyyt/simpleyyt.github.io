---
layout: post
categories: Java
title: 你知道 Redis 服务器接收到一条命令是如何执行的吗？
tagline: by 子悠
tags: 
  - 子悠
---

Hello 大家好，我是阿粉，Redis 作为工作中不可缺少的缓存组件，相信很多小伙伴都会使用到，我们日常使用的时候都是通过代码或者客户端去链接 Redis 服务器来操作数据的。那么一条简单的`set name ziyou` 命令是如何执行的，中间都经历了哪些过程想必很少会有人去了解。今天阿粉就带大家看一下一条简单的`set name ziyou` 命令是如何执行的。

<!--more-->

![image-20210530212711397](/Users/silence/Library/Application Support/typora-user-images/image-20210530212711397.png)

我们可以看到在执行`set name ziyou` 这个命令过后，先显示一个`OK` 在终端里面。下面我们看下这整个过程都经历了哪些步骤。

命令的整个执行分为下面几个步骤，我们先看流程，在仔细分析：

1. 客户端发送命令请求；
2. 服务端读取命令请求；
3. 命令执行器进行操作
   1. 命令执行器查找命令实现函数；
   2. 命令执行器执行预备操作；
   3. 命令执行器调用命令的实现函数；
   4. 命令执行器执行后续工作；
4. 服务端将命令回复发送给客户端；
5. 客户端接收并打印命令回复内容；

### 客户端发送命令请求

首先当客户端和服务端建立好了链接过后，当我们输入命令 `set name ziyou` 命令请求的时候，客户端会将这个命令进行协议转换，然后通过连接将转换后的协议发送到服务端。

比如当我们输入命令`set name ziyou` 的时候，客户端会将这个原始命令转换成`*3\r\n$3\r\nset\r\n$4\r\nname\r\n$5\r\nziyou`，这个协议大家应该比较眼熟，就是 Redis 管道的文件格式。简单解释下这个协议的意思，前面的`*3` 表示这个命令总共有三个参数，其中的`$3,$4,$5` 表示相应参数的长度。

### 服务端读取命令请求

当服务端收到该客户端的数据时，就会调用命令请求处理器来处理对应的消息。这块主要涉及到三个操作，第一个是保存命令，也就是会将命名的请求信息读取出来保存到对应客户端的输入缓冲区里面；保存完了过后会对输入缓冲区里面的内容进行解析，也就是对上面转换后的协议进行解析，解析出要执行的命令和对应的参数，将参数内容和参数个数保存到客户端的对应参数里面；第三步是调用命令执行器来执行命令。

### 命令执行器

#### 命令执行器查找实现函数

